<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –±—Ä–æ—Å–∫–æ–≤ –∫—É–±–∏–∫–æ–≤ —Å –ø—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π –∏ —Å–∏—Å—Ç–µ–º–æ–π –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞/–ø–æ–º–µ—Ö–∏">
  <meta name="theme-color" content="#0F0F23">
  <title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ë–æ–±—Ä–∏–Ω—ã–π / –ë–æ–±–∏–Ω–Ω—ã–π</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üé≤</text></svg>">
</head>
<body>
  <!-- –ö–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–µ–º—ã -->
  <button id="theme-toggle" class="theme-toggle" aria-label="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É">
    üåõ
  </button>
  
  <!-- –¢—É–ª—Ç–∏–ø –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞ -->
  <div id="chart-tooltip" class="chart-tooltip"></div>
  
  <div class="container">
    <!-- Header -->
    <header class="app-header">
      <h1 id="app-title" class="app-header__title">–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ë–æ–±–∏–Ω–Ω—ã–π</h1>
      <p class="app-header__subtitle">–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –±—Ä–æ—Å–∫–æ–≤ –¥–ª—è –Ω–∞—Å—Ç–æ–ª—å–Ω—ã—Ö RPG</p>
    </header>

    <main class="main-content">
      <!-- –û—Å–Ω–æ–≤–Ω–∞—è —Å–µ–∫—Ü–∏—è -->
      <div class="dice-section">
        
        <!-- –í–≤–æ–¥ —Ñ–æ—Ä–º—É–ª—ã -->
        <section class="card card--glow" aria-labelledby="formula-title">
          <h2 id="formula-title" class="sr-only">–í–≤–æ–¥ —Ñ–æ—Ä–º—É–ª—ã –±—Ä–æ—Å–∫–∞</h2>
          <div class="input-group">
            <label for="formula-input" class="input-group__label">–§–æ—Ä–º—É–ª–∞ –±—Ä–æ—Å–∫–∞</label>
            <input 
              type="text" 
              id="formula-input" 
              class="input input--formula" 
              placeholder="d20, 3d6+5, (d8+2)*2"
              autocomplete="off"
              spellcheck="false"
            >
            <div id="formula-error" class="input-error" aria-live="polite"></div>
          </div>
        </section>

        <!-- –ë—ã—Å—Ç—Ä—ã–µ –∫–Ω–æ–ø–∫–∏ –∫—É–±–∏–∫–æ–≤ -->
        <section class="quick-dice" aria-label="–ë—ã—Å—Ç—Ä—ã–µ –∫–Ω–æ–ø–∫–∏ –∫—É–±–∏–∫–æ–≤">
          <button class="btn-dice" data-dice="d4" aria-label="–ë—Ä–æ—Å–∏—Ç—å d4">d4</button>
          <button class="btn-dice" data-dice="d6" aria-label="–ë—Ä–æ—Å–∏—Ç—å d6">d6</button>
          <button class="btn-dice" data-dice="d8" aria-label="–ë—Ä–æ—Å–∏—Ç—å d8">d8</button>
          <button class="btn-dice" data-dice="d10" aria-label="–ë—Ä–æ—Å–∏—Ç—å d10">d10</button>
          <button class="btn-dice" data-dice="d12" aria-label="–ë—Ä–æ—Å–∏—Ç—å d12">d12</button>
          <button class="btn-dice" data-dice="d20" aria-label="–ë—Ä–æ—Å–∏—Ç—å d20">d20</button>
          <button class="btn-dice" data-dice="d100" aria-label="–ë—Ä–æ—Å–∏—Ç—å d100">d100</button>
        </section>

        <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ -->
        <section class="card" aria-labelledby="settings-title">
          <h2 id="settings-title" class="card__title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
          <div class="settings-row">
            
            <!-- –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ / –ü–æ–º–µ—Ö–∞ -->
            <div class="advantage-input-group">
              <label for="advantage-input" class="input-group__label">–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ (+) / –ü–æ–º–µ—Ö–∞ (-)</label>
              <input 
                type="number" 
                id="advantage-input" 
                class="input"
                value="0"
                placeholder="0"
              >
              <div id="advantage-desc" class="advantage-slider__desc">–æ–±—ã—á–Ω—ã–π –±—Ä–æ—Å–æ–∫</div>
            </div>
            
            <!-- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π -->
            <div class="input-group">
              <label for="times-input" class="input-group__label">–ü–æ–≤—Ç–æ—Ä–µ–Ω–∏–π</label>
              <input 
                type="number" 
                id="times-input" 
                class="input"
                value="1"
                min="1"
                max="100000"
              >
            </div>
            
            <!-- –ö–î -->
            <div class="input-group">
              <label for="kd-input" class="input-group__label">–ö–î (—Å–ª–æ–∂–Ω–æ—Å—Ç—å)</label>
              <input 
                type="number" 
                id="kd-input" 
                class="input"
                placeholder="–ù–µ –∑–∞–¥–∞–Ω–æ"
                min="1"
              >
            </div>
          </div>
        </section>

        <!-- –ö–Ω–æ–ø–∫–∞ –±—Ä–æ—Å–∫–∞ -->
        <button id="roll-btn" class="btn btn--cta btn--large w-full">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="2" y="2" width="20" height="20" rx="3"/>
            <circle cx="8" cy="8" r="1.5" fill="currentColor"/>
            <circle cx="16" cy="16" r="1.5" fill="currentColor"/>
            <circle cx="12" cy="12" r="1.5" fill="currentColor"/>
          </svg>
          –ë—Ä–æ—Å–∏—Ç—å!
        </button>

        <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç -->
        <section id="result-section" class="card hidden" aria-labelledby="result-title">
          <h2 id="result-title" class="sr-only">–†–µ–∑—É–ª—å—Ç–∞—Ç –±—Ä–æ—Å–∫–∞</h2>
          <div class="result-display">
            <div id="result-value" class="result-display__value">0</div>
            <div id="result-label" class="result-display__label">–°—É–º–º–∞</div>
          </div>
        </section>

        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
        <section id="stats-section" class="card hidden" aria-labelledby="stats-title">
          <h2 id="stats-title" class="card__title">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
          <div class="stats-grid">
            <div class="stat-card">
              <div id="stat-total" class="stat-card__value">‚Äî</div>
              <div class="stat-card__label">–°—É–º–º–∞</div>
            </div>
            <div class="stat-card">
              <div id="stat-avg" class="stat-card__value">‚Äî</div>
              <div class="stat-card__label">–°—Ä–µ–¥–Ω–µ–µ</div>
            </div>
            <div class="stat-card">
              <div id="stat-variance" class="stat-card__value">‚Äî</div>
              <div class="stat-card__label">–î–∏—Å–ø–µ—Ä—Å–∏—è</div>
            </div>
            <div class="stat-card">
              <div id="stat-stddev" class="stat-card__value">‚Äî</div>
              <div class="stat-card__label">–°—Ç–¥. –æ—Ç–∫–ª.</div>
            </div>
            <div class="stat-card">
              <div id="stat-min" class="stat-card__value">‚Äî</div>
              <div class="stat-card__label">–ú–∏–Ω–∏–º—É–º</div>
            </div>
            <div class="stat-card">
              <div id="stat-max" class="stat-card__value">‚Äî</div>
              <div class="stat-card__label">–ú–∞–∫—Å–∏–º—É–º</div>
            </div>
            <div class="stat-card">
              <div id="stat-p10" class="stat-card__value">‚Äî</div>
              <div class="stat-card__label">P10</div>
            </div>
            <div class="stat-card">
              <div id="stat-p50" class="stat-card__value">‚Äî</div>
              <div class="stat-card__label">P50 (–º–µ–¥–∏–∞–Ω–∞)</div>
            </div>
            <div class="stat-card">
              <div id="stat-p90" class="stat-card__value">‚Äî</div>
              <div class="stat-card__label">P90</div>
            </div>
            <div class="stat-card">
              <div id="stat-reliability" class="stat-card__value">‚Äî</div>
              <div class="stat-card__label">–ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å</div>
            </div>
          </div>
          
          <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç–∏ -->
          <div class="mt-1">
            <div class="progress">
              <div id="reliability-bar" class="progress__bar progress__bar--primary"></div>
            </div>
          </div>
          
          <!-- –ì–∏—Å—Ç–æ–≥—Ä–∞–º–º–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è -->
          <div id="histogram-container" class="histogram hidden">
            <h3 class="histogram__title">–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</h3>
            <div id="histogram-chart" class="histogram__chart"></div>
            <div class="histogram__labels">
              <span id="histogram-min"></span>
              <span id="histogram-max"></span>
            </div>
            <div class="histogram__stats">
              <div class="histogram__stat">
                <div id="histogram-mode" class="histogram__stat-value">‚Äî</div>
                <div class="histogram__stat-label">–ú–æ–¥–∞</div>
              </div>
              <div class="histogram__stat">
                <div id="histogram-peak-count" class="histogram__stat-value">‚Äî</div>
                <div class="histogram__stat-label">–ú–∞–∫—Å. —á–∞—Å—Ç–æ—Ç–∞</div>
              </div>
            </div>
          </div>
        </section>

        <!-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ –ö–î -->
        <section id="kc-section" class="card hidden" aria-labelledby="kc-title">
          <h2 id="kc-title" class="card__title">–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ –ö–î</h2>
          <div class="kc-panel">
            <div class="kc-stat">
              <div class="kc-stat__header">
                <span class="kc-stat__label">–£—Å–ø–µ—à–Ω—ã—Ö –±—Ä–æ—Å–∫–æ–≤</span>
                <span id="kc-success-value" class="kc-stat__value">‚Äî</span>
              </div>
              <div class="progress">
                <div id="kc-success-bar" class="progress__bar progress__bar--success"></div>
              </div>
            </div>
            <div class="kc-stat">
              <div class="kc-stat__header">
                <span class="kc-stat__label">–£—Ä–æ–Ω (—Å–∏—Å—Ç–µ–º–∞ –ë–æ–±—Ä–∞)</span>
                <span id="kc-damage-value" class="kc-stat__value">‚Äî</span>
              </div>
              <div class="kc-damage-hint">
                floor(—Ä–µ–∑—É–ª—å—Ç–∞—Ç / –ö–î) –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —É—Å–ø–µ—à–Ω–æ–≥–æ –±—Ä–æ—Å–∫–∞
              </div>
            </div>
          </div>
        </section>
        
        <!-- –ò—Å—Ç–æ—Ä–∏—è –≥—Ä–∞—Ñ–∏–∫–æ–≤ -->
        <section id="chart-history-section" class="card hidden" aria-labelledby="chart-history-title">
          <div class="history-header">
            <h2 id="chart-history-title" class="card__title mb-0">–ò—Å—Ç–æ—Ä–∏—è –≥—Ä–∞—Ñ–∏–∫–æ–≤</h2>
            <div class="chart-history-actions">
              <button id="compare-charts-btn" class="btn btn--primary btn--small" disabled>
                –°—Ä–∞–≤–Ω–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–µ
              </button>
              <button id="clear-chart-history-btn" class="history-item__btn">
                –û—á–∏—Å—Ç–∏—Ç—å
              </button>
            </div>
          </div>
          <div id="chart-history-list" class="chart-history-list"></div>
        </section>
        
        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è -->
        <div id="compare-modal" class="compare-modal hidden" onclick="if(event.target === this) this.classList.add('hidden')">
          <div class="compare-modal__content">
            <div class="compare-modal__header">
              <h3>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–æ–≤</h3>
              <button type="button" id="close-compare-btn" class="compare-modal__close" onclick="document.getElementById('compare-modal').classList.add('hidden')">&times;</button>
            </div>
            <div id="compare-chart-container" class="compare-modal__chart"></div>
            <div id="compare-legend" class="compare-modal__legend"></div>
          </div>
        </div>
      </div>

      <!-- –°–∞–π–¥–±–∞—Ä —Å –∏—Å—Ç–æ—Ä–∏–µ–π -->
      <aside class="card" aria-labelledby="history-title">
        <div class="history-header">
          <h2 id="history-title" class="card__title mb-0">–ò—Å—Ç–æ—Ä–∏—è</h2>
          <button id="clear-history-btn" class="history-item__btn" aria-label="–û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é">
            –û—á–∏—Å—Ç–∏—Ç—å
          </button>
        </div>
        <div id="history-list" class="history-list">
          <div class="history-empty">
            –ò—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞
          </div>
        </div>
      </aside>
    </main>

    <!-- Footer -->
    <footer class="app-footer">
      <p>–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è: d20, 3d6, 2d8+5, d12^2, (d6+1)*3</p>
    </footer>
  </div>

  <script type="module" src="app.js"></script>
</body>
</html>
